<div class="projectView">
    <?php echo $this->render('/project/projectlayout.phtml'); ?>

        <!-- Results -->
        <div class="projectBodyContent">
            <div class="clearfix">
                <div class="fleft searchForm">
                    <form action="<?php echo '/project/results/id/'.$this->id; ?>" method="get" autocomplete="off">
                        <div class="formGrp">
                            <label class="">Start Date</label>
                            <input type="text" name="st_date" id="st_date" value="" />

                            <label class="">End Date</label>
                            <input type="text" name="end_date" id="end_date" value="" />
                        </div>
                        <input type="submit" class="fright primary mediumButton" id="searchButton" name="search" value="Search" />
                    </form>
                </div>

                <div class="fright projectTweetFormat">
                    <span class="colTitle">Tweet Format: </span> <?php echo $this->project->getTweetFormat(); ?>
                </div>
            </div>

            <div id="results" class="projectResults">
                <div class="clearfix resultsContent">
                    <?php if(!empty($this->posts)) { ?>
                        <!-- Display Tweets Here -->
                        <div id="tweetsList" class="tweetsList fleft">

                            <?php foreach($this->posts as $post) { ?>

                                <div class="tweet">
                                    <div class="clearfix tweetHeading">
                                        <div class="fleft"><img src="/img/<?php echo strtolower($post->getSource()) ?>.png" style="height: 20px; width: 22px; margin-right: 5px" /></div>
                                        <div class="tweetName fleft"> <?php echo $post->getUsername() ?> </div>
                                        <div class="tweetUsername fleft"> @<?php echo $post->getUserScreenName() ?>  </div>
                                        <div class="tweetTime fleft"> <?php echo $post->getPostCreatedAt() ?> </div>
                                    </div>
                                    <div class="tweetMessage"><?php echo $post->getText() ?></div>
                                    <?php $place = $post->getPlace();
                                    if(!empty($place)) { ?>

                                        <div class="tweetLocation">
                                            <span class="colTitle">Location: </span><?php echo $post->getPlace(); ?>
                                        </div>

                                    <?php } ?>

                                    <input type="hidden" value="<?php echo $post->getId() ?>" id="postId" />
                                    <input type="hidden" value="<?php echo $post->getImageURL() ?>" class="imageUrl" />
                                    <input type="hidden" value="<?php echo $post->getCoordinatesLongitude() ?>" class="longitude" />
                                    <input type="hidden" value="<?php echo $post->getCoordinatesLatitude() ?>" class="latitude" />
                                </div>

                            <?php } ?>

                        </div>

                        <!-- Display Map Here -->
                        <div id="resultsMapCanvas" class="resultsMapCanvas fright">

                        </div>
                    <?php } else { ?>
                        <div>
                            Tweets/Posts are not available at this time.
                        </div>
                    <?php } ?>
                </div>
            </div>
        </div>
    </div> <!-- Closing DIV for the tag opened in projectlayout.phtml -->
</div>

<script src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
<script type="text/javascript">
    $(document).ready(function() {
        $('#tweetsList').niceScroll({cursorcolor:"#0070AF", autohidemode:false});

        // Add active class for Results menu
        $('.projectsListNav li:nth-child(2)').addClass('activeMenu');

        // Date Picker
        $("#st_date").datepicker({autoSize: true, dateFormat: "M d, yy", duration: "fast", maxDate: 0, showAnim: "slideDown"});
        $("#end_date").datepicker({autoSize: true, dateFormat: "M d, yy", duration: "fast", maxDate: 0, showAnim: "slideDown"});

        // On clicking show this tweet on map
        $('.tweet').click(function() {
            $('.tweet').removeClass('tweetSelected');
            $(this).addClass('tweetSelected');

            // Remove marker on map.
            if(undefined != marker) {
                marker.setMap(null);
            }
            googleMap.setZoom(2);
            // Get latitude and longitude coordinates for this post.
            var latitude = $(this).children('input.latitude').val();
            var longitude = $(this).children('input.longitude').val();

            if(latitude == "" || longitude == "") {
                alert('Location details are not available for this message.');
            } else {
                // Show marker on map
                var messageOnMap = '<div class="onMapContent"> <div class="onMapTitle">' + $(this).children('div.tweetMessage').html() + '</div>';
                var imageUrl = $(this).children('input.imageUrl').val();
                if(imageUrl) {
                    messageOnMap += '<img alt="Image was deleted" src="'+ imageUrl +'" width="400px" height="350px" />';
                }
                messageOnMap += '</div>';

                var placedMarker = placeMarkerOnMap(new google.maps.LatLng(latitude, longitude));

                // Set zoom level and center the map.
                googleMap.setZoom(10);
                googleMap.setCenter(placedMarker.getPosition());

                var infowindow = new google.maps.InfoWindow({
                    content: messageOnMap
                });

                google.maps.event.addListener(placedMarker, 'click', function() {infowindow.open(googleMap, placedMarker);});
            }
        });
    });

    <?php if(!empty($this->posts)) { ?>
        function initialize() {
            var map_canvas = document.getElementById('resultsMapCanvas');

            var myLatlng = new google.maps.LatLng(42.3493337, 13.398172299999942);
            var map_options = {
                center: myLatlng,
                zoom: 2,
                minZoom: 2
            }
            googleMap = new google.maps.Map(map_canvas, map_options);
        }
        google.maps.event.addDomListener(window, 'load', initialize);
    <?php } ?>
</script>